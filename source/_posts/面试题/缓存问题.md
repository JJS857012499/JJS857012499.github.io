---
title: 缓存问题
date: 2018-04-23 10:26:31
category: 面试题
tags: [缓存,面试题]
---
## 缓存穿透
*    什么是缓存穿透：一般的缓存系统，都是按照key去缓存查询，如果不存在，就应该去后端系统查找（比如DB）,如果key对应的value是一定不存在的，并且对该key的请求量很大，就会对后端系统造成很大的压力，这个就叫缓存穿透。
*    解决方案：1.对查询结果为空的情况也进行缓存，缓存时间设置短一些，或者该keu对应的数据insert了之后清理缓存。2.对一定不存在的key进行过滤。可以把所有可能存在的key放到一个大的bitmap中，查询的时候通过该bitmap进行过滤。
    
## 缓存雪崩
*    什么是缓存雪崩：当缓存服务器重启或者大量缓存集中在某个时间段失效，这样在失效的时候也会给后端服务器造成很大的压力。
*    解决方法：1.在缓存失效后，通过加锁来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。2.不同的key，设置不同的过期时间，让缓存失效时间尽量均匀。3：做二级缓存，A1为原始缓存，A2为拷贝缓存，A1失效时候，可以访问A2，A1缓存失效时间设置为短期，A2设置为长期
    
## 缓存一致性问题
*    1.缓存系统与底层系统是“可读可写”时候，写是尤为重要
*    2.有继承关系的缓存之间的一致性。为了尽量提高缓存命中率，缓存也是分层的：全局缓存，二级缓存。他们存在着继承关系。全局缓存可以由二级缓存组成
*    3.多个缓存副本之间的一致性。为了保证系统的高可用，缓存系统背后往往由两套缓存组成的（redis，memcache）
    
## 缓存数据的淘汰
*    缓存淘汰的策略有两种：1.定时去清理过期的缓存。2.当有用户的请求时，再判断这个请求所用到的缓存是否过期，过期的话就去底层系统得到最新数据更新缓存。两者各有优劣，第一种缺点是维护大量缓存的key是比较麻烦的，第二种的缺点是每次用户请求过来都要判断缓存失效，逻辑相对比较复杂。
    
## 缓存算法
*    先进先出：一个数据最先进入缓存则最先淘汰掉
*    最不经常使用：把缓存中最不经常使用的数据淘汰掉
*    近期最少使用算法：把近期最少使用的缓存清理掉
